#!/bin/sh

type UserRequireRoot >/dev/null 2>&1 || \
	. "/usr/local/share/myx.common/bin/user/requireRoot"

InstallEnsurePackageTransformPackageName(){
		case "$1" in
		        go)
		        	echo "golang" ; return 0 ;;
		        java)
		        	echo "openjdk" ; return 0 ;;
				*)
					echo "$1" ; return 0 ;;
		esac
}

InstallEnsurePackage(){
	# not on mac/brew: UserRequireRoot "InstallEnsurePackage"
	which -s brew || myx.common install/brew

	local NAME="$1"
	[ -z "$NAME" ] && echo "The utility name is required!" && exit 1

	local LIST=""

	for NAME in $@ ; do
		which -s $NAME \
			&& echo "ensure: $NAME already present, skip" >&2 \
			|| LIST="$LIST `InstallEnsurePackageTransformPackageName $NAME`"
	done

	[ -z "$LIST" ] \
		&& echo "all packages installed." >&2 \
		|| brew install $LIST
}

case "$0" in
	*/myx.common/bin/lib/installEnsurePackage) 
		if [ -z "$1" ] ; then
			echo "Syntax: myx.common lib/installEnsurePackage utility_name [package_name]" >&2
			exit 1
		fi
		set -e
		InstallEnsurePackage "$@"
	;;
esac
