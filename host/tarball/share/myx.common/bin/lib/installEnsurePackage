#!/bin/sh

type UserRequireRoot >/dev/null 2>&1 || \
	. "/usr/local/share/myx.common/bin/user/requireRoot"

InstallEnsurePackage(){
	# not on mac/brew: UserRequireRoot "InstallEnsurePackage"

	which -s brew || myx.common install/brew
	
	local UTILITY_NAME="$1"
	[ -z "$UTILITY_NAME" ] && echo "The utility name is required!" && exit 1

	local PACKAGE_NAME="${2:-$UTILITY_NAME}"
	
	if [ ! -z "`which $UTILITY_NAME`" ] ; then \
		echo "Utility is present: $UTILITY_NAME, skip" >&2
	 else \
		case "$PACKAGE_NAME" in
		        go)
		        	PACKAGE_NAME="golang"
		        	break
					;;
		        java)
					PACKAGE_NAME="openjdk"
		        	break
					;;
		esac
		brew install $PACKAGE_NAME
	fi
}

case "$0" in
	*/myx.common/bin/lib/installEnsurePackage) 
		if [ -z "$1" ] ; then
			echo "Syntax: myx.common lib/installEnsurePackage utility_name [package_name]" >&2
			exit 1
		fi
		set -e
		InstallEnsurePackage "$@"
	;;
esac
